@ <stdio.hdr>

@ "gen.hdr"
@ "lexer.hdr"
@ "parser.hdr"

fn main()
{
    getToken();
    // parse program (sequence of statements)
    while (true) {
        // parse statement
        local expr: -> Expr = parseExpr();
        if (!expr) {
            break;
        }
        if (token.kind != SEMICOLON) {
            printf("%u.%u: ';' expected\n", token.pos.row, token.pos.col);
            break;
        }
        getToken();
        genReleaseReg(loadExpr(expr));
//      printExprLatexTree(expr);
    }
    if (token.kind != EOI) {
        printf("syntax error\n");
    }
    genHalt(3);
    printf("\t.align 8\n");
    printf("x .quad 8\n");
    printf("\t.align 8\n");
    printf("y .quad 8\n");
    printf("\t.align 8\n");
    printf("z .quad 8\n");
}
